From b21ba0ccce5d241e982cad68a7487faaa09dccd3 Mon Sep 17 00:00:00 2001
From: Ian Jennings <ian@meetjennings.com>
Date: Wed, 8 Nov 2017 21:03:46 -0800
Subject: [PATCH] fix for bug where channel names can not have spaceS

---
 App.js                        |  9 ++++-----
 Navigation/DrawerContainer.js |  4 ++--
 components/MessageEntry.js    |  5 +++++
 components/MessageList.js     | 17 ++++++++++++-----
 package.json                  |  2 +-
 screens/ChatRoom.js           |  6 ++++--
 6 files changed, 28 insertions(+), 15 deletions(-)

diff --git a/App.js b/App.js
index 9ca0de1..938d2c7 100644
--- a/App.js
+++ b/App.js
@@ -27,12 +27,11 @@ import Chat from "./screens/Chat";
 
 const ChatEngine = ChatEngineCore.create(
   {
-    publishKey: "pub-c-c6303bb2-8bf8-4417-aac7-e83b52237ea6",
-    subscribeKey: "sub-c-67db0e7a-50be-11e7-bf50-02ee2ddab7fe"
+    publishKey: 'pub-c-d8599c43-cecf-42ba-a72f-aa3b24653c2b',
+    subscribeKey: 'sub-c-6c6c021c-c4e2-11e7-9628-f616d8b03518'
   },
   {
-    endpoint: "https://adamb-react-native-chat-engine.herokuapp.com/insecure",
-    globalChannel: "ajb-global-test-channel-345346685234356"
+    globalChannel: "ajb-global-test-channel-345346685234356343"
   }
 );
 
@@ -60,7 +59,7 @@ export default class App extends React.Component {
     if(username === ""){
       return; //do nothing on empty username
     }
-    
+
     ChatEngine.connect(
       username,
       {
diff --git a/Navigation/DrawerContainer.js b/Navigation/DrawerContainer.js
index d9b5228..c037a73 100644
--- a/Navigation/DrawerContainer.js
+++ b/Navigation/DrawerContainer.js
@@ -7,7 +7,7 @@ import UserList from '../components/UserList';
 
 const chatList = [
   {
-    name: "General Chat",
+    name: "GeneralChat",
     subtitle: "General Chat",
     unread: 5
   },
@@ -76,4 +76,4 @@ const styles = StyleSheet.create({
     flex: 1,
     backgroundColor: '#f6f6f6',
   },
-});
\ No newline at end of file
+});
diff --git a/components/MessageEntry.js b/components/MessageEntry.js
index 5870ed8..fdf0f81 100644
--- a/components/MessageEntry.js
+++ b/components/MessageEntry.js
@@ -25,10 +25,15 @@ class MessageEntry extends Component {
   }
 
   sendChat() {
+
     if (this.state.chatInput) {
+
+      console.log(this.state.chatInput)
+
       this.props.chat.emit("message", {
         text: this.state.chatInput
       });
+
       this.setState({ chatInput: "" });
     }
   }
diff --git a/components/MessageList.js b/components/MessageList.js
index 8c623ad..9c40dd1 100644
--- a/components/MessageList.js
+++ b/components/MessageList.js
@@ -70,29 +70,36 @@ class MessageList extends React.PureComponent {
     searchy.on('message', (data) => {
       this.setState({ messages: [...this.state.messages, data] });
     });
-    
+
+    console.log(this.props.chat);
+
     searchy.on('$.search.finish', () => {
       this.setState({loading:false, messages: this.state.messages.reverse()});
 
+      console.log('search finish called', this.props.chat)
+
       this.props.chat.on("message", payload => {
+
         this.setState({ messages: [...this.state.messages, payload] });
       });
+
     });
   }
 
-  componentWillUpdate(newProps){
+  componentWillUpdate(newProps) {
+
     if(this.props.chat !== newProps.chat){
       this.setState({messages: [], loading:true});
-  
+
       let searchy = newProps.chat.search({
         event: 'message',
         limit: 50
       });
-  
+
       searchy.on('message', (data) => {
         this.setState({ messages: [...this.state.messages, data] });
       });
-      
+
       searchy.on('$.search.finish', () => {
         this.setState({loading:false, messages: this.state.messages.reverse()});
 
diff --git a/package.json b/package.json
index cae747b..4dd72db 100644
--- a/package.json
+++ b/package.json
@@ -6,7 +6,7 @@
   "private": true,
   "main": "node_modules/expo/AppEntry.js",
   "dependencies": {
-    "chat-engine": "^0.7.0",
+    "chat-engine": "^0.8.3",
     "chat-engine-gravatar": "0.0.7",
     "chat-engine-markdown": "0.0.7",
     "chat-engine-online-user-search": "0.0.7",
diff --git a/screens/ChatRoom.js b/screens/ChatRoom.js
index 0ae3908..56de07f 100644
--- a/screens/ChatRoom.js
+++ b/screens/ChatRoom.js
@@ -25,10 +25,12 @@ export default class ChatRoom extends React.Component {
   }
 
   componentDidMount() {
+
     const chatEngine = this.props.screenProps.chatEngine;
-    let chat = new chatEngine.Chat("General Chat", false);
-    chat.plugin(typingIndicator({ timeout: 5000 }));
 
+    let chat = new chatEngine.Chat("GeneralChat", false);
+
+    chat.plugin(typingIndicator({ timeout: 5000 }));
     chat.plugin(ChatEngineMarkdown({}));
 
 
-- 
2.7.4

